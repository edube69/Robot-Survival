<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Test Timestamp Formatting</title>
    <style>
        body { font-family: 'Courier New', monospace; background: #111; color: #fff; padding: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border: 1px solid #333; }
    </style>
</head>
<body>
    <h1>Test Timestamp Formatting</h1>
    <div id="results"></div>
    
    <script>
        function formatTimestamp(timestamp) {
            if (!timestamp) return 'N/A';
            
            let date;
            if (timestamp.toDate && typeof timestamp.toDate === 'function') {
                date = timestamp.toDate();
            } else if (timestamp.seconds) {
                date = new Date(timestamp.seconds * 1000);
            } else if (timestamp instanceof Date) {
                date = timestamp;
            } else if (typeof timestamp === 'string' || typeof timestamp === 'number') {
                date = new Date(timestamp);
            } else {
                return 'N/A';
            }
            
            if (isNaN(date.getTime())) {
                return 'N/A';
            }
            
            const now = new Date();
            const diffMs = now.getTime() - date.getTime();
            const diffMinutes = Math.floor(diffMs / (1000 * 60));
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            let prefix = '';
            if (diffMinutes < 5) {
                prefix = '?? ';
            } else if (diffMinutes < 30) {
                prefix = '? ';
            }
            
            if (diffMinutes < 1) {
                return prefix + 'À l\'instant';
            } else if (diffMinutes < 60) {
                return prefix + `Il y a ${diffMinutes}min`;
            } else if (diffHours < 24) {
                return `Il y a ${diffHours}h`;
            } else if (diffDays < 7) {
                return `Il y a ${diffDays}j`;
            } else {
                const options = {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                };
                return date.toLocaleDateString('fr-FR', options);
            }
        }
        
        // Tests
        const now = new Date();
        const results = document.getElementById('results');
        
        const tests = [
            { name: 'Now', timestamp: now },
            { name: '2 minutes ago', timestamp: new Date(now.getTime() - 2 * 60 * 1000) },
            { name: '15 minutes ago', timestamp: new Date(now.getTime() - 15 * 60 * 1000) },
            { name: '2 hours ago', timestamp: new Date(now.getTime() - 2 * 60 * 60 * 1000) },
            { name: '3 days ago', timestamp: new Date(now.getTime() - 3 * 24 * 60 * 60 * 1000) },
            { name: '2 weeks ago', timestamp: new Date(now.getTime() - 14 * 24 * 60 * 60 * 1000) },
            { name: 'Firebase-like', timestamp: { seconds: Math.floor(Date.now() / 1000) - 300 } },
        ];
        
        tests.forEach(test => {
            const formatted = formatTimestamp(test.timestamp);
            results.innerHTML += `<div class="test-result"><strong>${test.name}:</strong> ${formatted}</div>`;
        });
    </script>
</body>
</html>